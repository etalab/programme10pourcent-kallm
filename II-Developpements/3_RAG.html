<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="équipe KALLM">
<meta name="dcterms.date" content="2024-06-07">

<title>PARTIE II. Développements autour des LLMs (pour les data scientists) – Guide d’installation des LLM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../II-Developpements/0_Introduction.html">II-Développements</a></li><li class="breadcrumb-item"><a href="../II-Developpements/3_RAG.html">Focus sur le RAG (Retrieval Augmented Generation)</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Guide d’installation des LLM</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Accueil</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">I-Accompagnement</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../I-Accompagnement/1_Besoins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Besoins</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../I-Accompagnement/2_Deja_Fait_Admin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exemples dans l’administration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../I-Accompagnement/3_Acculturation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acculturation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../I-Accompagnement/4_Impacts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Impacts</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../II-Developpements/0_Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">II-Développements</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../II-Developpements/1_Anatomie_LLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anatomie et conception d’un modèle de langage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../II-Developpements/2_Utilisation_LLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Techniques d’utilisation d’un LLM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../II-Developpements/3_RAG.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Focus sur le RAG (Retrieval Augmented Generation)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../II-Developpements/4_Evaluations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Evaluations</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">III-Déploiements</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../III-Deploiements/1_Socle_minimal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Socle minimal</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../III-Deploiements/2_Socle_avance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Socle avancé</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../III-Deploiements/3_Socle_Production.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Socle Production</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../III-Deploiements/4_Infras_administrations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infrastructures dans l’administration</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">IV-Exemples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../IV-Exemples/2_Classification_accords_entreprise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exemple des textes des accords d’entreprise</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Bibliographie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliographie</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#iii.-focus-sur-le-rag-retrieval-augmented-generation" id="toc-iii.-focus-sur-le-rag-retrieval-augmented-generation" class="nav-link active" data-scroll-target="#iii.-focus-sur-le-rag-retrieval-augmented-generation">III. Focus sur le RAG (Retrieval Augmented Generation)</a>
  <ul class="collapse">
  <li><a href="#principe-de-fonctionnement-général" id="toc-principe-de-fonctionnement-général" class="nav-link" data-scroll-target="#principe-de-fonctionnement-général">1. Principe de fonctionnement général</a></li>
  <li><a href="#recherche-dinformation" id="toc-recherche-dinformation" class="nav-link" data-scroll-target="#recherche-dinformation">2. Recherche d’information</a></li>
  <li><a href="#génération" id="toc-génération" class="nav-link" data-scroll-target="#génération">3. Génération</a></li>
  <li><a href="#comparatif-détaillé-des-solutions-de-stockages-de-données-pour-la-recherche-vectorielle-approximative" id="toc-comparatif-détaillé-des-solutions-de-stockages-de-données-pour-la-recherche-vectorielle-approximative" class="nav-link" data-scroll-target="#comparatif-détaillé-des-solutions-de-stockages-de-données-pour-la-recherche-vectorielle-approximative">4. Comparatif détaillé des solutions de stockages de données pour la recherche vectorielle approximative</a></li>
  <li><a href="#présentations-de-modules-avec-retex-code" id="toc-présentations-de-modules-avec-retex-code" class="nav-link" data-scroll-target="#présentations-de-modules-avec-retex-code">5. Présentations de modules avec RETEX, CODE!</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../II-Developpements/0_Introduction.html">II-Développements</a></li><li class="breadcrumb-item"><a href="../II-Developpements/3_RAG.html">Focus sur le RAG (Retrieval Augmented Generation)</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">PARTIE II. Développements autour des LLMs (pour les data scientists)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>équipe KALLM </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 7, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="iii.-focus-sur-le-rag-retrieval-augmented-generation" class="level2">
<h2 class="anchored" data-anchor-id="iii.-focus-sur-le-rag-retrieval-augmented-generation">III. Focus sur le RAG (Retrieval Augmented Generation)</h2>
<p>Le Retrieval Augmented Generation (RAG) est une technique courante utilisée pour améliorer les performances d’un LLM et de pallier ces déficiences. En effet les LLMs sont très performants pour de la génération de textes mais ils peuvent commettre des hallucinations, c’est-à-dire des affirmations qui semblent plausibles mais qui n’ont aucun fondement. Leur connaissance est aussi limitée par les données qui ont été utilisées pour l’entrainement, par exemple, un llm n’a pas accès aux informations contenues dans une base de connaissance privée car ces données ne sont pas contenues dans le corpus d’entrainement du llm.</p>
<p>Pour remédier à ces limitations le RAG propose de permettre à un LLM de s’appuyer sur une base de connaissance, généralement sous la forme de document contenant du texte pour répondre de manière pertinente à des questions, en utilisant de manière adéquate les informations contenues dans la base de connaissance.</p>
<p>Le LLM sera ainsi en mesure de répondre à des questions portant sur des points précis et sur des données sur lequel il n’a jamais été entrainé. En exploitant la base de connaissance il aura aussi moins tendance à inventer de fausses informations et donc à halluciner.</p>
<section id="principe-de-fonctionnement-général" class="level3">
<h3 class="anchored" data-anchor-id="principe-de-fonctionnement-général">1. Principe de fonctionnement général</h3>
<p>Un système de RAG va combiner la capacité de génération de textes d’un LLM avec de la recherche d’information dans une base de connaissance interne. Le RAG se compose principalement de deux parties, une première partie de retrieval dont le rôle est d’analyser une question de l’utilisateur et de trouver des éléments qui sont pertinents pour répondre à la question dans la base, et une seconde partie de génération qui contient le LLM et qui va incorporer le contexte récupérés par la partie de retrieval dans un prompt pour permettre au LLM de générer une réponse basée sur des éléments pertinents.</p>
</section>
<section id="recherche-dinformation" class="level3">
<h3 class="anchored" data-anchor-id="recherche-dinformation">2. Recherche d’information</h3>
<p>La partie de retrieval qui s’occupe de la recherche d’informations pertinentes dans la base joue un rôle essentiel pour le bon fonctionnement du RAG. En effet si des informations non pertinentes sont retournées au LLM il devient très difficile pour lui de formuler une réponse adéquate.</p>
<p>Il existe de nombreux algorithmes permettant d’effectuer cette recherche d’information, cependant l’une des approches les plus populaires se base sur l’utilisation de vecteurs denses. Dans cette méthode on utilise un encodeur pour transformer le texte en vecteurs de grandes dimensions que l’on stocke dans une base de données vectorielle. Cet encodeur a été entrainé a projeter des textes sémantiquement proches sur des vecteurs similaires. Lorsqu’une requête utilisateur est reçue en entrée, elle est elle aussi encodée dans un vecteur de même dimension. On peut alors comparer ce vecteur à l’ensemble des vecteurs présents en base ce qui permet de récupérer les vecteurs les plus proches qui correspondent à ceux qui sont sémantiquement proches. On peut ainsi trouver les morceaux de texte à envoyer au LLM pour la génération.</p>
</section>
<section id="génération" class="level3">
<h3 class="anchored" data-anchor-id="génération">3. Génération</h3>
<p>La phase de génération dans un système de RAG intervient après la récupération des documents pertinents. Une fois les documents récupérés, ils sont insérés dans un prompt que le LLM utilise pour produire des réponses contextuellement appropriées et précises. Plus le LLM est performant et correctement aligné sur les préférences humaines plus il est capable de prendre une quantité importante de document en contexte et ainsi de mieux répondre à la question.</p>
</section>
<section id="comparatif-détaillé-des-solutions-de-stockages-de-données-pour-la-recherche-vectorielle-approximative" class="level3">
<h3 class="anchored" data-anchor-id="comparatif-détaillé-des-solutions-de-stockages-de-données-pour-la-recherche-vectorielle-approximative">4. Comparatif détaillé des solutions de stockages de données pour la recherche vectorielle approximative</h3>
<p>Toutes les solutions testées sont open-source ou disposant d’une licence permissive, qui donne la possibilité d’héberger localement les données.</p>
<table>
<tbody><tr>
<th>
</th>
<th>
Weaviate
</th>
<th>
Milvus
</th>
<th>
Qdrant
</th>
<th>
ElasticSearch
</th>
<th>
FAISS
</th>
</tr>
<tr>
<td>
<strong>Open source</strong>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
Partiellement
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
</tr>
<tr>
<td>
<strong>Dev-friendly</strong>
</td>
<td>
+++
</td>
<td>
+
</td>
<td>
+++
</td>
<td>
++
</td>
<td>
+++
</td>
</tr>
<tr>
<td>
<strong>Déploiement</strong>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span> mais difficile à mettre en place, constellation de micro-services
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="x">❌</span> mais possibilité de construire une image Docker custom par exemple
</td>
</tr>
<tr>
<td>
<strong>Spécifique à la recherche vectorielle</strong>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="x">❌</span>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
</tr>
<tr>
<td>
<strong>Qualité de la documentation</strong>
</td>
<td>
+++ <a href="https://weaviate.io/developers/weaviate">[-]</a>
</td>
<td>
++ <a href="https://milvus.io/docs">[-]</a>
</td>
<td>
+++ <a href="https://qdrant.tech/documentation/">[-]</a>
</td>
<td>
++ <a href="https://www.elastic.co/guide/index.html">[-]</a>
</td>
<td>
+ <a href="https://faiss.ai/index.html">[-]</a>
</td>
</tr>
<tr>
<td>
<strong>Dernière mise à jour</strong>
</td>
<td>
mai 2024
</td>
<td>
mai 2024
</td>
<td>
mai 2024
</td>
<td>
mai 2024
</td>
<td>
mars 2024
</td>
</tr>
<tr>
<td>
<strong>Latence (ms)**</strong>
</td>
<td>
438.18
</td>
<td>
322.63
</td>
<td>
<strong>118.25</strong>
</td>
<td>
338.53
</td>
<td>
-
</td>
</tr>
<tr>
<td>
<p><strong>Requêtes/seconde</strong></p>
<strong>(RPS)**</strong>
</td>
<td>
217.98
</td>
<td>
281.52
</td>
<td>
<strong>710.23</strong>
</td>
<td>
275.11
</td>
<td>
-
</td>
</tr>
<tr>
<td>
<strong>P99 latence (ms)**</strong>
</td>
<td>
1723.62
</td>
<td>
436.87
</td>
<td>
<strong>144.78</strong>
</td>
<td>
589.61
</td>
<td>
-
</td>
</tr>
<tr>
<td>
<strong>Temps d’upload (minutes)**</strong>
</td>
<td>
71.61
</td>
<td>
<strong>1.41</strong>
</td>
<td>
2.074
</td>
<td>
14.33
</td>
<td>
-
</td>
</tr>
<tr>
<td>
<p><strong>Temps d’upload +</strong></p>
<strong>indexation (minutes)**</strong>
</td>
<td>
71.61
</td>
<td>
<strong>9.53</strong>
</td>
<td>
17.49
</td>
<td>
<p>122.79</p>
<span class="emoji" data-emoji="x">❌</span>
</td>
<td>
-
</td>
</tr>
<tr>
<td>
<strong>Place en mémoire</strong>
</td>
<td>
<code>num_vectors * vector_dimension * 4 bytes * 2</code> <a href="https://weaviate.io/developers/weaviate/concepts/resources#an-example-calculation">[-]</a>
</td>
<td>
Conséquente d’après les avis d’utilisateurs, pas de formules approximative <a href="https://milvus.io/tools/sizing/">[-]</a>
</td>
<td>
<code>num_vectors * vector_dimension * 4 bytes * 1.5</code> <a href="https://qdrant.tech/documentation/cloud/capacity-sizing/">[-]</a>
</td>
<td>
<code>num_vectors * 4 * (vector_dimension + 12)</code> <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-knn-search.html">[-]</a>
</td>
<td>
?
</td>
</tr>
<tr>
<td>
<strong>Type d’index</strong>
</td>
<td>
HNSW
</td>
<td>
FLAT, IVF_FLAT, IVF_SQ8, IVF_PQ, HNSW, BIN_FLAT, BIN_IVF_FLAT, DiskANN, GPU_IVF_FLAT, GPU_IVF_PQ, and CAGRA
</td>
<td>
HNSW
</td>
<td>
HNSW
</td>
<td>
FLAT, IVS_FLAT, IVF_SQ8, IVF_PQ, HNSW, BIN_FLAT and BIN_IVF_FLAT
</td>
</tr>
<tr>
<td>
<strong>Recherche hybride</strong>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span>
</td>
<td>
<span class="emoji" data-emoji="x">❌</span>
</td>
</tr>
<tr>
<td>
<strong>Ajout d’éléments à la volée, scalabilité</strong>
</td>
<td>
Partitionnement statique
</td>
<td>
<p>Segmentation</p>
dynamique
</td>
<td>
Partitionnement statique
</td>
<td>
Partitionnement statique
</td>
<td>
<p><span class="emoji" data-emoji="x">❌</span> (index</p>
immutable -&gt; vector library)
</td>
</tr>
<tr>
<td>
<strong>Accès contrôlé par rôles</strong>
</td>
<td>
<span class="emoji" data-emoji="x">❌</span> sur le backlog, mais n’avance beaucoup <a href="https://github.com/weaviate/weaviate/issues/2784">[-]</a>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span> <a href="https://milvus.io/docs/users_and_roles.md">[-]</a>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span> <a href="https://qdrant.tech/documentation/guides/security/">[-]</a>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span> <a href="https://www.elastic.co/guide/en/app-search/current/security-and-users.html">[-]</a>
</td>
<td>
<span class="emoji" data-emoji="x">❌</span>
</td>
</tr>
<tr>
<td>
<p><strong>Partions et étanchéité des bases de données</strong></p>
<strong>(<em>multi-tenancy</em>)</strong>
</td>
<td>
<span class="emoji" data-emoji="x">❌</span> pas très clair, mais il semble que ce ne soit pas encore possible <a href="https://forum.weaviate.io/t/understanding-on-multi-tenancy/2067/2">[-]</a>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span> Plusieurs systèmes de partitions, très flexible <a href="https://milvus.io/docs/multi_tenancy.md">[-]</a>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span> Plusieurs systèmes de partitions, assez flexible <a href="https://qdrant.tech/documentation/guides/multiple-partitions/">[-]</a>
</td>
<td>
<span class="emoji" data-emoji="white_check_mark">✅</span> Possible mais pas très intuitif <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/document-level-security.html">[-]</a>
</td>
<td>
<span class="emoji" data-emoji="x">❌</span>
</td>
</tr>
<tr>
<td>
<strong>Autres avantages</strong>
</td>
<td>
</td>
<td>
<ul>
<li>Très dynamique car chaque action a son propre node, facile à scaler</li>
<li>Plusieurs niveaux de partitions</li>
</ul>
</td>
<td>
</td>
<td>
<ul>
<li>Stockage d’autres types de données, par exemple l’historique de conversations</li>
<li>Très commun comme solution de stockage, donc plus d’utilisateurs déjà familiers de l’outil</li>
</ul>
</td>
<td>
</td>
</tr>
<tr>
<td>
<strong>Autres inconvénients</strong>
</td>
<td>
</td>
<td>
<ul>
<li>Taille en mémoire (difficile à quantifier par rapport aux autres, mais plus importante selon les benchmarks)</li>
</ul>
</td>
<td>
<ul>
<li>Pas de stockage S3</li>
</ul>
</td>
<td>
</td>
<td>
<ul>
<li>Bibliothèque de vecteurs, pas vraiment adaptée à un usage persistant</li>
</ul>
</td>
</tr>
</tbody></table>
<p>** <a href="https://qdrant.tech/benchmarks/">Qdrant benchmark</a> (janvier 2024), dataset = gist-960-euclidean (1M de vecteurs en dimension 960), précision à 0.95</p>
<p>Les solutions présentées recouvrent en fait plusieurs cas d’usage :</p>
<ul>
<li>Les <strong>bibliothèques vectorielles</strong> (<em>vector library</em>) de type FAISS sont adaptées à de la rechercher sémantique à la volée, avec constitution de la base et recherche immédiate. Ici il s’agira d’un cas d’usage où l’utilisateur apporte son propre document avec un téléchargement en temps réel, et pose des questions dessus ou demande une synthèse.</li>
<li>Les <strong>bases de données vectorielles</strong> (<em>vector database</em>) sont des dispositifs plus lourds et généralement un peu plus lents, mais avec un stockage permanent et beaucoup plus de flexibilité dans la recherche. Ils sont plus adaptés à un cas d’usage où la base de connaissance est constituée en amont et doit être mise à jour de temps en temps.</li>
</ul>
<p>Pour une mise en production rapide et efficace <strong>Qdrant</strong> semble être la meilleure solution, combiné à une base de données plus traditionnelle comme ElasticSearch pour l’historique des conversations. Pour avoir une approche tout-en-en, et plus de flexibilité dans la gestion des collections, c’est <strong>ElasticSearch</strong> qui se détache des autres, malgré des temps d’indexation assez conséquents.</p>
<blockquote class="blockquote">
<p>Aparté sur les intégrations Langchain : à manipuler avec précaution, les fonctions ne sont pas toujours explicites (par exemple la méthode <code>from_documents</code> supprime et recrée en général une collection). De plus certaines fonctionnalités comme l’utilisation de partitions ne sont pas toujours accessibles via Langchain. Il peut être utile de recréer des wrapper qui utilisent en partie Langchain et en partie les fonctions natives de la base de données.</p>
</blockquote>
<section id="annexes" class="level4">
<h4 class="anchored" data-anchor-id="annexes">Annexes</h4>
<section id="définitions" class="level5">
<h5 class="anchored" data-anchor-id="définitions">Définitions</h5>
<p><strong>Dev-friendly</strong> -&gt; Note qualitative après installation de chaque solution (sauf FAISS) dans une image Docker, et utilisation avec Python (avec et sans l’intégration Langchain)</p>
<p><strong>Déploiement</strong> -&gt; Existence d’un écosystème de déploiement</p>
<p><strong>Qualité de la documentation</strong> -&gt; Note qualitative après installation de chaque solution (sauf FAISS) dans une image Docker, et utilisation avec Python (avec et sans l’intégration Langchain)</p>
<p><strong>Ajout d’éléments à la volée, scalabilité</strong> -&gt; Comment l’indexation se fait si la base de données est modifiée. Avec le partitionnement statique (<em>static sharding</em>), si la capacité du serveur est augmentée toutes les données doivent être de nouveau partitionnées, ce qui peut être long.</p>
<p><strong>Recherche hybride</strong> -&gt; Possibilité d’effectuer des recherches dans les métadonnées, avec des nombres ou des chaînes de caractères</p>
<p><strong>Accès contrôlé par rôles (<em>RBAC</em>)</strong>-&gt; Autorisations prédéfinies pour chaque utilisateur, avec un accès différencié aux documents</p>
</section>
<section id="ressources" class="level5">
<h5 class="anchored" data-anchor-id="ressources">Ressources</h5>
<p>https://weaviate.io/blog/vector-library-vs-vector-database</p>
<p><a href="https://ann-benchmarks.com/index.html">ANN Benchmark</a> (avril 2023)</p>
</section>
</section>
</section>
<section id="présentations-de-modules-avec-retex-code" class="level3">
<h3 class="anchored" data-anchor-id="présentations-de-modules-avec-retex-code">5. Présentations de modules avec RETEX, CODE!</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/etalab\.github\.io\/programme10pourcent-kallm\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Ce site a été créé avec <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>